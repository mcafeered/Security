penetration = ethical hacking

Testing
Exploit Development occurs from vulnerability pairing and mission-drivens requirement
Test and verify success
Testing provides a number of benefits:
Faster time to breakout of initial foothold
Reduced risk of detection and/or tool failure
Improved recovery times

Plan
Procure Hardware and software
Assign developer
Assign a tester to develop TTPs and break it
Document testing results
Testing environment

Open Source Intelligence
During the lesson we will review the following topics:
Appropriate Documentation Practices
Use of Collected Data
Collection Methods

DoD States:
"produced from publicly available information that is collected, exploited, and disseminated in a timely manner to an appropriate audience for addressing a specific intelligence requirement."
only use open source research for mission completion meeting a specific intelligence requirement

Documentation
Why is it important?
What should we include in documentation?
basically take opnotes to document what you did and how

Collection and Use
What do we want to collect?
How can it be used in operations?
We never reveal our sources and methods which indicates a NOFORN classification

Limitations on Collection
Are there rules that guide our operations and collection parameters?
What are important factors when collecting data about a target?

Data to Collect
Web Data
Sensitive Data
Publicly Accessible
Social Media
Domain and IP Data

Deep web = unlisted addresses ex. signing into your banck account

Hyper-Text Markup Language (HTML)
Standardized markup language for browser interpretation of webpages

Client-side interpretation (web browser)
Utilizes elements (identified by tags)
Typically redirects to another page for server-side interaction
Cascading Stylesheets (CSS) for page themeing
can use view page source to view a website's source code, but use a website scraper for bigger/confusing websites

Advanced Scanning Techniques
HOST DISCOVERY
Find hosts that are online
HOST ENUMERATION
Find ports for each host that is online
HOST INTERROGATION
Find what service is running on each open/available port

NMAP Scripting Engine
During the lesson we will review the following topics:
Benefits of Scanning with Scripts
Script Management and Utilization
Usage and Examples

nmap can be used with several different scripts to achieve certain information

Script Management
Scripts are stored in a subdirectory of the Nmap data directory by default:
/usr/share/nmap/scripts

Usage and Examples
nmap --script <filename>|<category>|<directory>
nmap --script-help "ftp-* and discovery"
nmap --script-args <args>
nmap --script-args-file <filename>
nmap --script-help <filename>|<category>|<directory>
nmap --script-trace

========================== Web Exploitation Day 1 (XSS) ====================================
Server/Client Relationship
Synchronous communications between user and services
Not all data is not returned, client only receives what is allowed

Hyper-Text Transfer Protocol (HTTP)
Request/Response
Various tools to view:
tcpdump
wireshark
Developer Console
ex.
GET / HTTP/1.1
HTTP/1.1 200 OK

HTTP Methods
A Select Few:
GET
POST
HEAD
PUT

HTTP Response Codes
10X == Informational
2XX == Success
30X == Redirection
4XX == Client Error
5XX == Server Error

HTTP Fields
User-Agent
Referer
Cookie
Date
Server
Set-Cookie

HTTP Method Notes
GET request can be utilized to pass data to the server using the URL string:
https://www.columbiacountyga.gov/Home/Components/JobPosts/Job/1/1/something.php?var=hi

Wget
Recursively download
Recover from broken transfers
SSL/TLS support
wget -r -l2 -P /tmp ftp://ftpserver/
wget --save-cookies cookies.txt --keep-session-cookies --post-data 'user=1&password=2' https://website
wget --load-cookies cookies.txt -p https://website/interesting/article.php

cURL
Not recursive
Can use pipes
Upload ability
Supports more protocols vs Wget, such as SCP & POP3
curl -o stuff.html https://web.site/stuff.html
curl 'https://web.site/submit.php' -H 'Cookie: name=123; settings=1,2,3,4,5,6,7' --data 'name=Stan' | base64 -d > item.png

JavaScript (JS)
Allows websites to interact with the client
JavaScript runs on the client’s machine
Coded as .JS files, or in-line of HTML

JS Interaction
<script>
function myFunction() {
    document.getElementById("demo").innerHTML = "Paragraph changed.";
}
</script>
<script src="https://www.w3schools.com/js/myScript1.js"></script>

Enumeration
ROBOTS.TXT
Legitimate surfing
Tools:
NSE scripts
Nikto
Burp suite (outside class)

Cross-Site Scripting (XSS) Overview
Insertion of arbitrary code into a webpage, that executes in the browser of visitors
Unsanitized GET, POST, and PUT methods allow JS to be placed on websites
Often found in forums that allow HTML

Reflected XSS
Most common form of XSS
Transient, occurs in error messages or search results
Delivered through intermediate media, such as a link in an email
Characters that are normally illegal in URLs can be Base64 encoded
Below is what you see, but the server will decode as name=abc123

Stored XSS
Resides on vulnerable site
Only requires user to visit page
<img src="http://invalid" onerror="window.open('http://10.50.XX.XX:8000/ram.png','xss','height=1,width=1');">

Useful JavaScript Components
Proof of concept (simple alert):
<script>alert('XSS');</script>
Capturing Cookies
document.cookie
Capturing Keystrokes
bind KEYDOWN and KEYUP
Capturing Sensitive Data
document.body.innerHTML

Server-Side injection
Directory Traversal/Path Traversal
Ability to read/execute outside web server’s directory
Uses ../../ (relative paths) in manipulating a server-side file path

Malicious File Upload
Site allows unsanitized file uploads
Server doesn’t validate extension or size
Allows for code execution (shell)
Once uploaded
Find your file
Call your file

Command Injection
Application on the server is vulnerable,
allowing execution of arbitrary commands
User input not validated
Common example is a SOHO router, with a web page to allow ping
Might contain the following in it’s code:
system("ping -c 1 ".$_GET["ip"]);
Run the following to chain/stack our arbitrary command
; cat /etc/passwd

when using firefox use F12 to bring up developer tools then check the inspector and network tabs

================================== SQL =====================================

SQL
S tructured Q uery L anguage - ANSI Standard
Additional commands added by vendors
Relational

Standard Commands --------------------------------------------------------------------
SELECT
Extracts data from a database

UNION
Used to COMBINE the result-set of TWO OR MORE SELECT STATEMENTS

USE
Selects the DB to use

UPDATE
Updates data in a database

DELETE
Deletes data from a database

INSERT INTO
Inserts new data into a database

CREATE DATABASE
Creates a new database

ALTER DATABASE
Modifies a database

CREATE TABLE
Creates a new table

ALTER TABLE
Modifies a table

DROP TABLE
Deletes a table

CREATE INDEX
Creates an index (search key)

DROP INDEX
Deletes an index

----------------------------------------------------------------------------

SQL Injection - Considerations
Requires Valid SQL Queries
Fully patched systems can be vulnerable due to misconfiguration
Input Field Sanitization
String vs Integer Values
Is INFORMATION_SCHEMA Database available?
GET Request versus POST Request HTTP methods

Unsanitized vs Sanitized Fields ----------------------------------------------
Unsanitized: input fields can be found using a Single Quote ⇒ '
Will return extraneous information
' closes a variable, to allow for additional statements/clauses
May show no errors or generic error (harder Injection)

Sanitized: input fields are checked for items that might harm the database (Items are removed, escaped, or turned into a single string)

Validation: checks inputs to ensure it meets a criteria (String doesn’t contain ')

-----------------------------------------------------------------------------

Server-Side Query Processing
User enters JOHNDOE243 in the name form field and PASS1234$ in the pass form field.
The Server-Side Query that would be passed to MySQL from PHP would be:
BEFORE INPUT:
SELECT id FROM users WHERE name=‘$name’ AND pass=‘$pass’;
AFTER INPUT:
SELECT id FROM users WHERE name=‘JohnDoe243’ AND pass=‘pass1234’;

Example - Injecting Your Statement
User enters TOM' OR 1='1 in the name and pass fields.
Truth Statement: tom ' OR 1='1
Server-Side query executed would appear like this:
SELECT id FROM users WHERE name=‘tom' OR 1='1’ AND pass=‘tom' OR 1='1’
(By default there are '' at the beginning and end of the WHERE statement values given, this is random which means you havt to phanangle it)
find a vulnerable field where you can enter information and then use the sql injection to get the database 
to find a vulnerable field insert USER ' OR 1='1 (might have to mess around with the quotes for best results)
POST methods mean you are entering information (try multiple fields (exploiting lazy programmer))


GET methods have you use the URL bar to see the variable you use to add 1=1 where after you find the vulnerability use <pretext> UNION select 1,2,3 to see the columns and what numbers they are
<pretext> UNION select table_schema, table_name, column_name from information_schema.columns (since you're breaking the datbases you can only work with the amount of columns you have, meaning you would have to add placeholders if there is more than 3)

Stacking Statements
Chaining multiple statements together using a semi-colon ;
SELECT * FROM user WHERE id=‘Johnny'; DROP TABLE Customers; --’

Nesting statements
Some Web Application + SQL Database combinations do not allow stacking, such as PHP and MySQL.
Though they may allow for nesting a statement within an existing one:
php?key=<value> UNION SELECT 1,column_name,3 from information_schema.columns where table_name = 'members'

Ignore the rest
Using # or -- tells the Database to ignore everything after
Server-Side Query:
SELECT product FROM item WHERE id = $select limit 1;
Input to Inject:
1 OR 1=1; #
Server-Side Query becomes:
SELECT product FROM item WHERE id = 1 or 1=1; # limit 1;
